<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ExpressionBodySyntax.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">code-coverage-report</a> &gt; <a href="index.source.html" class="el_package">io.gitlab.arturbosch.detekt.rules.style</a> &gt; <span class="el_source">ExpressionBodySyntax.kt</span></div><h1>ExpressionBodySyntax.kt</h1><pre class="source lang-java linenums">package io.gitlab.arturbosch.detekt.rules.style

import io.gitlab.arturbosch.detekt.api.CodeSmell
import io.gitlab.arturbosch.detekt.api.Config
import io.gitlab.arturbosch.detekt.api.Configuration
import io.gitlab.arturbosch.detekt.api.Entity
import io.gitlab.arturbosch.detekt.api.Rule
import io.gitlab.arturbosch.detekt.api.config
import org.jetbrains.kotlin.lexer.KtTokens
import org.jetbrains.kotlin.psi.KtBinaryExpression
import org.jetbrains.kotlin.psi.KtBlockExpression
import org.jetbrains.kotlin.psi.KtDeclarationWithBody
import org.jetbrains.kotlin.psi.KtExpression
import org.jetbrains.kotlin.psi.KtNamedFunction
import org.jetbrains.kotlin.psi.KtProperty
import org.jetbrains.kotlin.psi.KtReturnExpression
import org.jetbrains.kotlin.psi.psiUtil.anyDescendantOfType

/**
 * Functions which only contain a `return` statement can be collapsed to an expression body. This shortens and
 * cleans up the code.
 *
 * &lt;noncompliant&gt;
 * fun stuff(): Int {
 *     return 5
 * }
 * &lt;/noncompliant&gt;
 *
 * &lt;compliant&gt;
 * fun stuff() = 5
 *
 * fun stuff() {
 *     return
 *         moreStuff()
 *             .getStuff()
 *             .stuffStuff()
 * }
 * &lt;/compliant&gt;
 */
<span class="fc" id="L40">class ExpressionBodySyntax(config: Config) : Rule(</span>
<span class="fc" id="L41">    config,</span>
<span class="fc" id="L42">    &quot;Functions with exact one statement, the return statement, can be rewritten with ExpressionBodySyntax.&quot;</span>
) {

    @Configuration(&quot;include return statements with line wraps in it&quot;)
<span class="fc" id="L46">    private val includeLineWrapping: Boolean by config(false)</span>

    override fun visitProperty(property: KtProperty) {
<span class="fc" id="L49">        super.visitProperty(property)</span>
<span class="fc bfc" id="L50" title="All 2 branches covered.">        property.getter?.checkForExpressionBodySyntax()</span>
<span class="fc bfc" id="L51" title="All 2 branches covered.">        property.setter?.checkForExpressionBodySyntax()</span>
<span class="fc" id="L52">    }</span>

    override fun visitNamedFunction(function: KtNamedFunction) {
<span class="fc" id="L55">        super.visitNamedFunction(function)</span>
<span class="fc" id="L56">        function.checkForExpressionBodySyntax()</span>
<span class="fc" id="L57">    }</span>

    private fun KtDeclarationWithBody.checkForExpressionBodySyntax() {
<span class="fc" id="L60">        val stmt = bodyExpression</span>
<span class="fc bfc" id="L61" title="All 2 branches covered.">            ?.singleReturnStatement()</span>
<span class="fc bfc" id="L62" title="All 4 branches covered.">            ?.takeUnless { it.containsReturnStmtsInNullableArguments() }</span>

<span class="fc bfc" id="L64" title="All 6 branches covered.">        if (stmt != null &amp;&amp; (includeLineWrapping || !isLineWrapped(stmt))) {</span>
<span class="fc" id="L65">            report(CodeSmell(Entity.from(stmt), description))</span>
        }
<span class="fc" id="L67">    }</span>

    private fun KtExpression.singleReturnStatement(): KtReturnExpression? =
<span class="pc bpc" id="L70" title="1 of 8 branches missed.">        (this as? KtBlockExpression)?.statements?.singleOrNull() as? KtReturnExpression</span>

    private fun KtReturnExpression.containsReturnStmtsInNullableArguments(): Boolean =
<span class="fc bfc" id="L73" title="All 4 branches covered.">        anyDescendantOfType&lt;KtReturnExpression&gt; { (it.parent as? KtBinaryExpression)?.operationToken == KtTokens.ELVIS }</span>

    private fun isLineWrapped(expression: KtExpression): Boolean =
<span class="fc" id="L76">        expression.children.any { it.text.contains('\n') }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202408290909</span></div></body></html>