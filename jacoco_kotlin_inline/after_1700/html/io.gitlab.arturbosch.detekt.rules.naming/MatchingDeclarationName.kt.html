<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MatchingDeclarationName.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">code-coverage-report</a> &gt; <a href="index.source.html" class="el_package">io.gitlab.arturbosch.detekt.rules.naming</a> &gt; <span class="el_source">MatchingDeclarationName.kt</span></div><h1>MatchingDeclarationName.kt</h1><pre class="source lang-java linenums">package io.gitlab.arturbosch.detekt.rules.naming

import io.gitlab.arturbosch.detekt.api.ActiveByDefault
import io.gitlab.arturbosch.detekt.api.CodeSmell
import io.gitlab.arturbosch.detekt.api.Config
import io.gitlab.arturbosch.detekt.api.Configuration
import io.gitlab.arturbosch.detekt.api.Entity
import io.gitlab.arturbosch.detekt.api.Rule
import io.gitlab.arturbosch.detekt.api.config
import org.jetbrains.kotlin.com.intellij.psi.PsiFile
import org.jetbrains.kotlin.psi.KtClassOrObject
import org.jetbrains.kotlin.psi.KtFile
import org.jetbrains.kotlin.psi.KtTypeAlias
import org.jetbrains.kotlin.psi.psiUtil.isPrivate

/**
 * &quot;If a Kotlin file contains a single non-private class (potentially with related top-level declarations),
 * its name should be the same as the name of the class, with the .kt extension appended.
 * If a file contains multiple classes, or only top-level declarations,
 * choose a name describing what the file contains, and name the file accordingly.
 * Use camel humps with an uppercase first letter (e.g. ProcessDeclarations.kt).
 *
 * The name of the file should describe what the code in the file does.
 * Therefore, you should avoid using meaningless words such as &quot;Util&quot; in file names.&quot; - Official Kotlin Style Guide
 *
 * More information at: https://kotlinlang.org/docs/coding-conventions.html
 *
 * &lt;noncompliant&gt;
 *
 * class Foo // FooUtils.kt
 *
 * fun Bar.toFoo(): Foo = ...
 * fun Foo.toBar(): Bar = ...
 *
 * &lt;/noncompliant&gt;
 *
 * &lt;compliant&gt;
 *
 * class Foo { // Foo.kt
 *     fun stuff() = 42
 * }
 *
 * fun Bar.toFoo(): Foo = ...
 *
 * &lt;/compliant&gt;
 */
@ActiveByDefault(since = &quot;1.0.0&quot;)
<span class="fc" id="L48">class MatchingDeclarationName(config: Config) : Rule(</span>
<span class="fc" id="L49">    config,</span>
<span class="fc" id="L50">    &quot;If a source file contains only a single non-private top-level class or object, &quot; +</span>
        &quot;the file name should reflect the case-sensitive name plus the .kt extension.&quot;
) {

    @Configuration(&quot;name should only be checked if the file starts with a class or object&quot;)
<span class="fc" id="L55">    private val mustBeFirst: Boolean by config(true)</span>

    @Configuration(&quot;kotlin multiplatform targets, used to allow file names like `MyClass.jvm.kt`&quot;)
<span class="fc" id="L58">    private val multiplatformTargets: List&lt;String&gt; by config(COMMON_KOTLIN_KMP_PLATFORM_TARGET_SUFFIXES)</span>

    override fun visitKtFile(file: KtFile) {
<span class="fc" id="L61">        val declarations = file.declarations</span>
<span class="fc" id="L62">            .asSequence()</span>
<span class="fc" id="L63">            .filterIsInstance&lt;KtClassOrObject&gt;()</span>
<span class="fc" id="L64">            .filterNot { it.isPrivate() }</span>
<span class="fc" id="L65">            .toList()</span>

        fun matchesFirstClassOrObjectCondition(): Boolean =
<span class="pc bpc" id="L68" title="1 of 6 branches missed.">            !mustBeFirst || mustBeFirst &amp;&amp; declarations.first() === file.declarations.first()</span>

        fun hasNoMatchingTypeAlias(filename: String): Boolean =
<span class="pc bpc" id="L71" title="1 of 2 branches missed.">            file.declarations.filterIsInstance&lt;KtTypeAlias&gt;().all { it.name != filename }</span>

<span class="fc bfc" id="L73" title="All 4 branches covered.">        if (declarations.size == 1 &amp;&amp; matchesFirstClassOrObjectCondition()) {</span>
<span class="fc" id="L74">            val declaration = declarations.first()</span>
<span class="fc" id="L75">            val declarationName = declaration.name</span>
<span class="fc" id="L76">            val filename = file.fileNameWithoutSuffix(multiplatformTargets)</span>
<span class="pc bpc" id="L77" title="1 of 4 branches missed.">            if (declarationName != filename &amp;&amp; hasNoMatchingTypeAlias(filename)) {</span>
<span class="fc" id="L78">                val entity = Entity.atName(declaration)</span>
<span class="fc" id="L79">                report(</span>
<span class="fc" id="L80">                    CodeSmell(</span>
<span class="fc" id="L81">                        Entity(entity.name, entity.signature, entity.location, file),</span>
<span class="fc" id="L82">                        &quot;The file name '$filename' &quot; +</span>
<span class="fc" id="L83">                            &quot;does not match the name of the single top-level declaration '$declarationName'.&quot;</span>
                    )
                )
            }
        }
<span class="fc" id="L88">    }</span>

    companion object {

<span class="fc" id="L92">        private val COMMON_KOTLIN_KMP_PLATFORM_TARGET_SUFFIXES = listOf(</span>
<span class="fc" id="L93">            &quot;ios&quot;,</span>
<span class="fc" id="L94">            &quot;android&quot;,</span>
<span class="fc" id="L95">            &quot;js&quot;,</span>
<span class="fc" id="L96">            &quot;jvm&quot;,</span>
<span class="fc" id="L97">            &quot;native&quot;,</span>
<span class="fc" id="L98">            &quot;iosArm64&quot;,</span>
<span class="fc" id="L99">            &quot;iosX64&quot;,</span>
<span class="fc" id="L100">            &quot;macosX64&quot;,</span>
<span class="fc" id="L101">            &quot;mingwX64&quot;,</span>
<span class="fc" id="L102">            &quot;linuxX64&quot;</span>
        )
    }
}

/**
 * Removes kotlin specific file name suffixes, e.g. .kt.
 * Note, will not remove other possible/known file suffixes like '.java'
 */
<span class="fc" id="L111">internal fun PsiFile.fileNameWithoutSuffix(multiplatformTargetSuffixes: List&lt;String&gt; = emptyList()): String {</span>
<span class="fc" id="L112">    val fileName = this.name</span>
<span class="fc" id="L113">    val suffixesToRemove = multiplatformTargetSuffixes.map { platform -&gt; &quot;.$platform.kt&quot; } + listOf(&quot;.kt&quot;, &quot;.kts&quot;)</span>
<span class="fc bfc" id="L114" title="All 2 branches covered.">    for (suffix in suffixesToRemove) {</span>
<span class="fc bfc" id="L115" title="All 2 branches covered.">        if (fileName.endsWith(suffix)) {</span>
<span class="fc" id="L116">            return fileName.removeSuffix(suffix)</span>
        }
    }
<span class="fc" id="L119">    return fileName</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202409090933</span></div></body></html>